<!DOCTYPE html>
<html>

<head>
    <title>proxyAnddefineProperty</title>
</head>

<body>
    <input id="def" type="text"><span id="defShow"></span>
    <hr>
    <input id="pro" type="text"><span id="proShow"></span>
    <hr>
    <input id="cabbagePro" type="text"><span id="cabbageShow"></span>
    <script>
        let obj = {};
        let arr = [1, 2, 3, 4, 5, 6, 7];
        let def = document.getElementById('def');
        let pro = document.getElementById('pro');
        let myPro = document.getElementById('cabbagePro');
        let proShow = document.getElementById('proShow');
        let defShow = document.getElementById('defShow');
        let myShow = document.getElementById('cabbageShow');


        //proxy相比definedProperty在数组上的提升
        //defineProperty
        Object.defineProperty(obj, 'arr', {
            set: function (newVal) {
                console.log('arr newVal:', newVal);
                //return this.arr[2];
            },
            get: function () {
                console.log('arr get');
                return arr;
            }
        })

        def.addEventListener('keyup', (e) => {
            obj.arr = [1, 2, 3]; //触发set: arr newVal: (3) [1, 2, 3]
            obj.arr[2] = e.target.value; //触发get: arr get
            defShow.innerHTML = obj.arr[2]; //触发get: arr get
        });


        //Proxy
        let arr02 = [1, 2, 3];
        let obj02 = new Proxy(arr02, {
            set: function (target, key, newVal, receiver) {
                console.log('set', 'index:', key, 'newVal:', newVal);
                return Reflect.set(target, key, newVal, receiver);
            },
            get: function (target, key, receiver) {
                console.log('get', 'index:', key, 'value:', target[key]);
                return target[key];
            }
        })

        //obj02.push(2);
        obj02.unshift(111);
        pro.addEventListener('keyup', (e) => {
            //obj02 = [1, 2, 3, 4, 5, 56]; //修改obj02指向，proxy设置失效
            obj02[2] = e.target.value; //触发set: set index: 2 newVal: 2
            proShow.innerHTML = obj02[2]; //触发get: arr get
        });
    </script>
</body>

</html>
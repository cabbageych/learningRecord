<!DOCTYPE <!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>compare with promise 02</title>
</head>

<body>
    <script>
        //现在把业务要求改一下，仍然是三个步骤，但每一个步骤都需要之前每个步骤的结果。(感受async代码的简洁)
        function takeLongTime(n) {
            return new Promise(resolve => {
                setTimeout(() => resolve(n + 200), n);
            });
        }

        function step1(n) {
            console.log(`step1 with ${n}`);
            return takeLongTime(n);
        }

        function step2(n1, n) {
            console.log(`step2 with ${n1} ${n}`);
            return takeLongTime(n1);
        }

        function step3(n2, n1, n) {
            console.log(`step3 with ${n2} ${n1} ${n}`);
            return takeLongTime(n2);
        }
        //使用promise
        /*function test() {
            console.time('time');
            let timer1 = 300;
            step1(timer1).then(timer2 => {
                return step2(timer2, timer1).then(timer3 => [timer3, timer2, timer1]);
            }).then(arr => {
                return step3(arr[0], arr[1], arr[2]).then(result => [result, arr[0], arr[1], arr[2]]);
            }).then(ans => {
                console.log('result', ans);
                console.timeEnd('time');
            })
        }*/
        //使用async
        async function test() {
            console.time("counting");
            let timer1 = 300;
            let timer2 = await step1(timer1);
            let timer3 = await step2(timer2, timer1);
            let result = await step3(timer3, timer2, timer1);
            console.log('result', result, timer3, timer2, timer1);
            console.timeEnd("counting");
        }
        test();
    </script>
</body>

</html>
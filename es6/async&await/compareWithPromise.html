<!DOCTYPE <!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>compare with promise</title>
</head>

<body>
    <script>
        /*
        async/await 的优势在于处理 then 链
        单一的 Promise 链并不能发现 async/await 的优势，但是，如果需要处理由多个 Promise 组成的 then 链的时候，
        优势就能体现出来了（很有意思，Promise 通过 then 链来解决多层回调的问题，现在又用 async/await 来进一步优化它）。
        */
        //假设一个业务，分多个步骤完成，每个步骤都是异步的，而且依赖于上一个步骤的结果。

        function takeLongTime(n) {
            return new Promise(resolve => {
                setTimeout(() => resolve(n + 200), n);
            });
        }

        function step1(n) {
            console.log(`step1 with ${n}`);
            return takeLongTime(n);
        }

        function step2(n) {
            console.log(`step2 with ${n}`);
            return takeLongTime(n);
        }

        function step3(n) {
            console.log(`step3 with ${n}`);
            return takeLongTime(n);
        }
        //使用promise
        /*实现1
        function doIt() {
            console.time("doIt");
            const time1 = 300;
            step1(time1)
                .then(time2 => step2(time2))
                .then(time3 => step3(time3))
                .then(result => {
                    console.log(`result is ${result}`);
                    console.timeEnd("doIt");
                });
        }
        doIt(); //doIt: 1511.7548828125ms
        //实现2
        function test(time) {
            console.time('time');
            step1(time).then(val => {
                return step2(val).then(val => val);
            }).then(val => {
                return step3(val).then(val => val);
            }).then(val => {
                console.log(`end with ${val}`);
                console.timeEnd('time');
            })
        }
        test(300);
        */

        //使用async
        async function doIt() {
            console.time('doIt');
            let timer1 = 300;
            let timer2 = await step1(timer1);
            let timer3 = await step2(timer2);
            let result = await step3(timer3);
            console.log('end', result);
            console.timeEnd('doIt');
        }
        doIt();
    </script>
</body>

</html>
<!DOCTYPE html>
<html>

<head>
    <title>post</title>
</head>

<body>
    <button onclick="ajaxSub()">ajaxSub</button><span id="ajaxData"></span>
    <hr>
    <button onclick="fetchSub()">fetchSub</button><span id="fetchData"></span>
    <script>
        var ajaxData = document.getElementById('ajaxData');
        var fetchData = document.getElementById('fetchData');
        var dataToSend = { name: 'cabbage', age: '18' };
        function ajaxSub() {
            var xhr = new XMLHttpRequest();
            //跨域请求带上cookie
            xhr.withCredentials = true;
            xhr.open('POST', 'http://localhost:8080', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState != 4) {
                    return;
                }
                if (xhr.status < 300 && xhr.status >= 200) {
                    if (isJSON(xhr.responseText)) {
                        ajaxData.innerHTML = 'isJSON';
                        console.log(JSON.parse(xhr.responseText));
                    } else {
                        ajaxData.innerHTML = xhr.responseText;
                    }
                } else {
                    console.log(xhr.statusText);
                }
            }
            xhr.send(JSON.stringify(dataToSend));
            //xhr.send("for testing...");
            //需要时可以使用xhr.abort()中断请求
        }

        function fetchSub() {
            fetch("http://localhost:8080",{
                credentials:'include',
                method:'POST',
                body:JSON.stringify({name:'cabbage',age:18})
            }).then((response)=>{
                if(response.status>=200&&response.status<300){
                    return response.text();
                }else{
                    throw new Error(response.statusText);
                }
            }).then((val)=>{
                if(isJSON(val)){
                    fetchData.innerHTML = 'isJSON';
                    console.log(JSON.parse(val));
                }else{
                    fetchData.innerHTML = val;
                }
            })
        }


        function isJSON(str) {
            try {
                if (JSON.parse(str)) {
                    return true;
                }
            } catch{
                return false;
            }

        }
    </script>
</body>

</html>
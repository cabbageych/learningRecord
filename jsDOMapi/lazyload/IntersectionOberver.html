<!DOCTYPE html>
<html>

<head>
    <title>IntersectionObserver</title>
    <style>
        img {
            height: 600px;
            width: 600px;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <img src="../canvasAndSVg/canvas/IMG_20170425_164207.jpg" data-src="./01.jpg">
    <img src="../canvasAndSVg/canvas/IMG_20170425_164207.jpg" data-src="./02.jpg">
    <img src="../canvasAndSVg/canvas/IMG_20170425_164207.jpg" data-src="./03.jpg">
    <script>
        //括号中的回调函数参数是一个数组，每一个元素都是一个对象
        //数组信息如下
        /*
        time：可见性发生变化的时间，是一个高精度时间戳，单位为毫秒
        target：被观察的目标元素，是一个 DOM 节点对象
        rootBounds：根元素的矩形区域的信息，getBoundingClientRect()方法的返回值，如果没有根元素（即直接相对于视口滚动），则返回null
        boundingClientRect：目标元素的矩形区域的信息
        intersectionRect：目标元素与视口（或根元素）的交叉区域的信息
        intersectionRatio：目标元素的可见比例，即intersectionRect占boundingClientRect的比例，完全可见时为1，完全不可见时小于等于0
        */
        let test = new IntersectionObserver(args => {
            args.forEach(function (arg) {
                if (arg.intersectionRatio <= 0) {
                    console.log(arg.target.getAttribute('src'), arg.target.getAttribute('data-src'));
                    return;
                }
                arg.target.src = arg.target.getAttribute('data-src');
                console.log(arg.intersectionRatio);
                console.log(arg.target);
                //图片显示后，停止对该图片的观察
                test.unobserve(arg.target);
                //停止观察器
                //test.disconnect();
            });
        });
        let arr = document.getElementsByTagName('img');
        for (let i = 0; i < arr.length; i++) {
            test.observe(arr[i]);
        }
    </script>
</body>

</html>